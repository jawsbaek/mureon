# AI FinOps Product Requirements Document (PRD)

## Goals and Background Context

### Goals
- 비용 가시성 확보: 모델/서비스/팀/고객/세션/요청 단위 단위경제 제공
- 최적화 실행력 강화: LLM 라우팅·캐싱·GPU 권장·라이트사이징 자동화/반자동화
- 거버넌스 수립: 쇼백/예산/경보, 데이터 주권/규제 준수, 변경 감사 추적

### Background Context
AI 워크로드는 고가의 가속기 자원과 장시간 연산, 대용량 데이터로 인해 비용 변동성과 관리 난도가 높습니다. 온프렘과 멀티클라우드가 혼재된 환경에서는 비용 가시성과 정책 거버넌스가 단절되기 쉽습니다. 본 PRD는 AnyCost 수집/표준화, 단위경제 대시보드, 이상탐지, 라우팅, GPU 권장, 쇼백/예산 경보를 중심으로 8–12주 MVP를 정의합니다.

### Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-09-15 | 0.1 | PRD 초기 골격 생성(Goals/Background/Changelog) | PM |

## Requirements

### Functional (FR)
- FR1: AnyCost 수집/표준화(클라우드 청구/Usage, 온프렘 Slurm/K8s/Prometheus, LLM 제공자 메트릭)
- FR2: 단위경제 대시보드(모델/요청/세션/고객/피처/SDLC) 제공
- FR3: 비용 이상탐지 v1 및 RCA(배포/프롬프트 길이/모델 버전 상관) 기능
- FR4: LLM 라우팅 v1(비용·지연 기반, 응답/임베딩 캐시, 폴백)
- FR5: GPU 권장 v1(잡 프로파일 기반 타입 추천 + 스팟+체크포인트 템플릿)
- FR6: 쇼백/예산 초과 경보(팀/제품 단위)
- FR7: API/SDK(수집·질의·권장·정책), 기본 RBAC/감사 로그
- FR8: Next.js 기반 웹 UI 제공(SSR/ISR 지원), 역할별 대시보드 라우트 구성
- FR9: 라우팅 정책/예산 경보/권장 설정을 위한 관리 UI(폼/검증/롤백)

### Non Functional (NFR)
- NFR1: 주요 대시보드 p95 응답 < 500ms(캐시 적중 시 < 200ms)
- NFR2: 데이터 주권 준수(리전 격리, PII 마스킹) 및 감사 가능성 확보
- NFR3: 멀티클라우드·온프렘 하이브리드 커넥터 확장성(신규 커넥터 추가 2주 내)
- NFR4: 운영 가용성 99.5% 이상(업무시간 기준), 관측성 지표/경보 제공
- NFR5: 비용 안전장치(쿼리 제한, 샘플링/캐시로 비용 급증 방지)
- NFR6: Next.js 페이지 LCP p75 < 2.5s(데스크탑), CLS < 0.1, a11y WCAG AA
- NFR7: SEO/프리렌더링: 핵심 마케팅/문서 페이지 ISR≤5분, 대시보드는 noindex

## User Interface Design Goals
- 프레임워크: Next.js(App Router) 기반, 서버 액션/SSR 우선, 클라이언트 컴포넌트 최소화
- 네비게이션: 역할별 섹션 라우트(`/finops`, `/platform`, `/product`)와 전역 검색
- 핵심 화면: 로그인, 메인 지표 개요, 단위경제 탐색, 이상탐지 상세, 라우팅 정책, GPU 권장, 예산/경보 설정
- 상태관리: 서버 컴포넌트+RSC 캐시, 클라이언트는 React Query/서스펜스로 보강
- 접근성/반응형: WCAG AA, 모바일 퍼스트, 키보드 내비게이션/라이브영역

## Technical Assumptions
- 저장: 데이터 레이크 + OLAP(ClickHouse/BigQuery/Snowflake) + 핫 캐시
- 수집: 프로메테우스/Slurm/K8s/클라우드 청구/LLM 제공자 메트릭
- 엔진: 코스트 모델, 이상탐지, 라우팅 정책, 권장(스팟/체크포인트)
- 인터페이스: API/SDK, 알림(슬랙/이메일), RBAC/감사 로그
- 프론트엔드: Next.js(App Router, SSR/ISR), TypeScript, Tailwind(또는 사내 디자인 시스템)
- 성능: ISR로 요약 페이지 캐시, 데이터 조회는 서버 컴포넌트에서 스트리밍
- 테스트 전략: Unit + Integration 우선, 핵심 경로 E2E 최소화
- 리포지토리: Monorepo(앱+백엔드+공용 패키지), Turborepo/biome(선택) 고려
- 아키텍처: 서비스는 Monolith 우선(모듈 경계 명확화), 커넥터/배치 잡은 서버리스/잡 런너 혼용
- 보안/거버넌스: PII 마스킹, 데이터 주권(리전 격리), 감사 로그 180일 보존, 최소권한 원칙
- 관측성: OpenTelemetry(로그/메트릭/트레이스), 대시보드/경보 템플릿 제공
- 배포: 환경 Dev/Staging/Prod, 점진 릴리스(피처 플래그), IaC는 Terraform 우선
- 데이터 가드레일: 쿼리 타임아웃/행 제한/샘플링, 캐시 우선 정책

## Epic List
- Epic 1: Foundation & AnyCost 수집/표준화 – 초기 커넥터/스키마와 최소 대시보드 가동
- Epic 2: 단위경제 대시보드 & 쇼백 – 핵심 지표 시각화와 팀/제품 예산 경보
- Epic 3: 비용 이상탐지 & RCA – 스파이크 탐지와 배포/프롬프트/버전 상관 분석
- Epic 4: LLM 라우팅 v1 – 비용·지연 기반 정책, 캐시/폴백, 섀도 테스트 지원
- Epic 5: GPU 권장 v1 – 잡 프로파일 기반 타입 추천과 스팟+체크포인트 템플릿

## Next Steps
- PM 체크리스트 실행 및 섹션 보강
- UX Expert/Architect 프롬프트 준비

### UX Expert Prompt
이 PRD를 기반으로 UX 프레임을 구체화해주세요.
- 목표: 롤별 대시보드와 핵심 흐름의 정보구조(IA)와 와이어프레임 초안
- 전제: Next.js(App Router), 모바일 퍼스트, WCAG AA, 서버 컴포넌트 우선
- 산출: 핵심 화면 목록별(로그인/메인지표/단위경제/이상탐지/라우팅정책/GPU권장/예산·경보) 주요 위젯, 상태/에러/로딩, 필터 UX 정의
- 제한: 브랜드 가이드는 임시, 컴포넌트 시스템은 Tailwind 기준 토큰 우선

### Architect Prompt
이 PRD를 기반으로 아키텍처 v1을 작성해주세요.
- 목표: 데이터 수집/정규화(AnyCost), 저장(레이크+OLAP), 엔진(코스트/이상탐지/라우팅/권장), 인터페이스(API/SDK/RBAC/감사) 전체 설계
- 전제: 하이브리드(온프렘+멀티클라우드), 보안/주권 준수, 관측성/테스트 전략 포함
- 산출: 서비스/데이터 다이어그램, 스키마 개요, API 표면, 성능/가용성 가드, 마이그레이션/릴리스 플랜(8–12주)
- 제한: MVP 범위 내 복잡도 최소화, 커넥터 2종부터 단계 확장

## Checklist Results (PM)
요약: PRD 구조/흐름/우선순위 검토 결과, MVP 가치를 빠르게 제공할 수 있는 합리적 분해로 판단합니다. 보완 필요 항목은 아래와 같습니다.

- 요구사항 추적성: 각 Epic Story AC ↔ FR/NFR 매핑 표는 아키텍트 산출 이후 업데이트 권장
- 보안/거버넌스: RBAC 범위와 감사 로그 보존 정책(기간/역할) 명시 필요
- 성능/비용 가드: 대시보드/리포트 쿼리 상한 및 샘플링 정책 문서화 필요
- 데이터 품질: 태그 자동추론/보정 규칙의 예외 처리 케이스 목록화 필요

상태: PASS(경고 포함) — 보완 항목은 설계 단계 병행 처리 권장


## Epic Details

### Epic 1 Foundation & AnyCost 수집/표준화
본 에픽은 초기 레포/CI/CD/관측성 기반을 마련하고, 최소 1개 클라우드 청구/Usage와 1개 온프렘(예: Prometheus 또는 Slurm) 커넥터를 통해 AnyCost 스키마로 정규화하여 최소 대시보드를 가동합니다.

#### Story 1.1 프로젝트 부트스트랩과 헬스체크
As a 플랫폼 엔지니어,
I want Next.js 기반 UI와 기본 CI/CD, 헬스체크 경로를 마련하고 품질 가드레일을 세팅,
so that 다음 스토리들이 빠르게 가치를 낼 수 있습니다.

Acceptance Criteria
1: Next.js(App Router, TS) 초기화 및 린트/포맷/테스트 파이프라인(CI) 구성
2: 헬스체크 라우트 및 메인 대시보드 골격 페이지 렌더(SSR)
3: 기본 RBAC 스텁/Feature flag 토글 도입
4: 문서화(README, 실행/배포/환경변수)

#### Story 1.2 AnyCost 스키마 v1과 커넥터 PoC(클라우드 1종)
As a 데이터 엔지니어,
I want 클라우드 청구/Usage를 AnyCost 스키마로 적재,
so that 표준화된 질의로 단위경제 계산이 가능합니다.

Acceptance Criteria
1: AnyCost 스키마 v1 정의(비용/리소스/태그 차원 포함)
2: 클라우드 1종 커넥터/적재 파이프라인 구현(샘플 데이터 포함)
3: 정규화 검증 쿼리 및 기초 집계 뷰 제공
4: 장애/리트라이/관측성(로그/메트릭) 확보

#### Story 1.3 온프렘 메트릭 PoC(프로메테우스 또는 Slurm)
As a 플랫폼 엔지니어,
I want 온프렘 메트릭을 수집/정규화,
so that 하이브리드 환경의 비용 가시성이 확보됩니다.

Acceptance Criteria
1: 프로메테우스 또는 Slurm 데이터 수집/맵핑 구현
2: AnyCost 스키마와 조인 가능한 키/태그 정합성 확보
3: 최소 단위경제 카드 위젯 1종(SSR) 렌더
4: 보안/접근 제어 기준 점검(네트워크/토큰/역할)

---

### Epic 2 단위경제 대시보드 & 쇼백
핵심 단위경제 지표를 역할별로 시각화하고, 팀/제품 단위 쇼백 리포트와 예산 경보를 제공합니다.

#### Story 2.1 단위경제 대시보드 v1
As a 재무 사용자,
I want 모델/요청/세션/고객/피처/SDLC 축의 핵심 지표 대시보드,
so that 비용 드라이버를 신속히 파악합니다.

Acceptance Criteria
1: 역할 기반 레이아웃과 KPI 카드/트렌드/필터(기간/팀/모델)
2: SSR로 초기 페인트, 상호작용은 클라이언트 최소화(React Query)
3: 지표 계산 정확성 샘플 테스트 및 숫자 서식/통화 단위 일관성
4: 접근성(a11y) 준수와 반응형 레이아웃

#### Story 2.2 쇼백 리포트 생성 및 내보내기
As a 재무 사용자,
I want 팀/제품별 쇼백 리포트를 생성/다운로드,
so that 비용 책임성과 예산 계획을 지원합니다.

Acceptance Criteria
1: 쇼백 계산 로직(API) 및 리포트 UI(필터/미리보기)
2: CSV/Excel 내보내기, 타임존/통화 고려
3: 데이터 품질 검증(누락 태그/보정 규칙 표시)
4: 감사 로그 기록(생성/다운로드 이벤트)

#### Story 2.3 예산/경보 설정
As a 제품/재무 사용자,
I want 예산 임계치 설정과 알림 채널 연동,
so that 초과 위험을 사전에 파악합니다.

Acceptance Criteria
1: 예산 임계치 CRUD UI/검증 및 정책 저장
2: Slack/Email 알림 연동, 서프레션/쿨다운
3: 경보 히스토리/해제 사유 기록 및 감사 로그
4: 권한/역할별 가시성 제어

---

### Epic 3 비용 이상탐지 & RCA
스파이크 이상탐지를 구현하고 배포/프롬프트 길이/모델 버전 등과의 상관을 제공하여 RCA를 돕습니다.

#### Story 3.1 스파이크 이상탐지 파이프라인 v1
As a 플랫폼 엔지니어,
I want 코스트 타임시리즈에서 스파이크를 감지,
so that 잠재 낭비를 신속히 포착합니다.

Acceptance Criteria
1: 배치/스트림 중 택1 PoC와 임곗값/계절성 고려
2: 이상 이벤트 저장/조회 API 및 요약 카드 표시
3: 경보 연동(선택) 및 소음 억제 전략 문서화
4: 재현/평가 데이터셋과 기준 메트릭 정의

#### Story 3.2 RCA 상관 분석(배포/프롬프트/버전)
As a 엔지니어,
I want 이상 이벤트와 배포/프롬프트 길이/모델 버전의 상관을 시각화,
so that 근본 원인 파악이 쉬워집니다.

Acceptance Criteria
1: 상관 계산/순위화 API 및 드릴다운 UI
2: 필터(기간/팀/모델) 조합 성능 검증
3: 결과 재현 가능성 보장(쿼리/버전 고정)
4: 개인정보/민감 데이터 비노출 검증

#### Story 3.3 인시던트 타임라인과 확인 흐름
As a SRE/플랫폼 엔지니어,
I want 이상 이벤트 타임라인과 확인/해제 워크플로우,
so that 대응 현황을 추적합니다.

Acceptance Criteria
1: 타임라인 UI와 상태 전이(열림/확인/해제)
2: 코멘트/태그/담당자 지정 및 감사 로그
3: 검색/필터/정렬 UX
4: 권한/가시성 제어

---

### Epic 4 LLM 라우팅 v1
비용·지연 기반 정책과 캐시/폴백, 섀도 테스트를 지원하는 라우터를 제공합니다.

#### Story 4.1 응답/임베딩 캐시
As a 플랫폼 엔지니어,
I want 응답/임베딩 캐시 정책과 적중률 지표,
so that 비용/지연을 절감합니다.

Acceptance Criteria
1: 캐시 키 전략/만료/무효화 설계 및 메트릭
2: 정책 토글(UI)과 히트율 대시보드 카드
3: 프라이버시/보안(PII) 검토 및 암호화(필요시)
4: 장애 시 폴백 전략 문서화

#### Story 4.2 비용·지연 기반 라우팅과 폴백
As a 엔지니어,
I want 모델 선택 라우팅과 폴백 규칙,
so that 성공률과 비용 균형을 최적화합니다.

Acceptance Criteria
1: 라우팅 정책 엔진(API)과 관측성(선택 결과/지연/성공률)
2: 폴백 순서/타임아웃/재시도 규칙 구성
3: 섀도/AB 토글 및 결과 비교 카드
4: 정책 버전관리 및 롤백

#### Story 4.3 정책 관리 UI
As a 제품/플랫폼 사용자,
I want 정책 CRUD UI와 승인 흐름,
so that 변경이 통제되고 추적됩니다.

Acceptance Criteria
1: 폼 검증/적용 전 미리보기/변경 이력
2: 권한/승인 워크플로우(이중 승인 옵션)
3: 감사 로그와 알림 연동
4: 접근성/반응형 검증

---

### Epic 5 GPU 권장 v1
잡 프로파일 기반 GPU 타입 추천과 스팟+체크포인트 템플릿을 제공합니다.

#### Story 5.1 잡 프로파일 수집 및 스키마
As a 플랫폼 엔지니어,
I want GPU/메모리/IO/재시작 지표를 수집/정규화,
so that 추천의 근거 데이터를 확보합니다.

Acceptance Criteria
1: 프로파일 스키마/수집 파이프라인 및 품질 검증
2: 조인 키 설계(작업/사용자/팀)와 샘플 대시보드 카드
3: 보존 주기/스토리지 비용 가드레일
4: 보안/접근 제어 검토

#### Story 5.2 스팟+체크포인트 템플릿과 마법사 UI
As a 엔지니어,
I want 스팟 사용과 체크포인트 주기 템플릿 및 UI 마법사,
so that 안전하게 비용을 절감합니다.

Acceptance Criteria
1: 템플릿 파라미터(프리엠프 허용/주기/스토리지) 정의
2: 적용/검증/롤백 UX 및 가드레일
3: 문서/경고(데이터 손실 주의) 노출
4: 샌드박스 환경 실증 테스트

#### Story 5.3 추천 API와 승인 흐름
As a 제품/플랫폼 사용자,
I want 추천 API/대시보드와 승인 워크플로우,
so that 운영 안정성을 보장합니다.

Acceptance Criteria
1: 추천 근거(설명 가능성) 제공과 임팩트 추정
2: 승인/거부/코멘트/이력
3: 적용 후 모니터링 카드(효과 검증)
4: 권한/감사/알림 일관성


